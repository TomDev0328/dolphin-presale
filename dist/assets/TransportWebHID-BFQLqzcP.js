import{V as Nt,T as H,b,a as ye,S as Ae,c as Ot,g as yt,l as At,d as st,D as Pt,e as Pe,f as _t}from"./index-iT-c14EB.js";let it=0;const G=[],_e=(r,t,e)=>{const n={type:r,id:String(++it),date:new Date};t&&(n.message=t),ot(n)},xt=({type:r,message:t,data:e,context:n})=>{const i={type:r,id:String(++it),date:new Date};t&&(i.message=t),e&&(i.data=e),n&&(i.context=n),ot(i)};class z{constructor(t,e){this.type=t,this.context=e}trace(t,e){xt({type:this.type,message:t,data:e,context:this.context})}getContext(){return this.context}setContext(t){this.context=t}updateContext(t){this.context=Object.assign(Object.assign({},this.context),t)}getType(){return this.type}setType(t){this.type=t}withType(t){return new z(t,this.context)}withContext(t){return new z(this.type,t)}withUpdatedContext(t){return new z(this.type,Object.assign(Object.assign({},this.context),t))}}const bt=r=>(G.push(r),()=>{const t=G.indexOf(r);t!==-1&&(G[t]=G[G.length-1],G.pop())});function ot(r){for(let t=0;t<G.length;t++)try{G[t](r)}catch(e){console.error(e)}}typeof window<"u"&&(window.__ledgerLogsListen=bt);var W=function(r,t,e,n){function i(s){return s instanceof e?s:new e(function(l){l(s)})}return new(e||(e=Promise))(function(s,l){function u(c){try{a(n.next(c))}catch(f){l(f)}}function o(c){try{a(n.throw(c))}catch(f){l(f)}}function a(c){c.done?s(c.value):i(c.value).then(u,o)}a((n=n.apply(r,t||[])).next())})};const Ct="transport";class Ie{constructor({context:t,logType:e}={}){this.exchangeTimeout=3e4,this.unresponsiveTimeout=15e3,this.deviceModel=null,this._events=new Nt,this.send=(n,i,s,l,...u)=>W(this,[n,i,s,l,...u],void 0,function*(o,a,c,f,g=b.Buffer.alloc(0),d=[Ae.OK],{abortTimeoutMs:p}={}){const y=this.tracer.withUpdatedContext({function:"send"});if(g.length>=256)throw y.trace("data.length exceeded 256 bytes limit",{dataLength:g.length}),new H("data.length exceed 256 bytes limit. Got: "+g.length,"DataLengthTooBig");y.trace("Starting an exchange",{abortTimeoutMs:p});const N=yield this.exchange(b.Buffer.concat([b.Buffer.from([o,a,c,f]),b.Buffer.from([g.length]),g]),{abortTimeoutMs:p});y.trace("Received response from exchange");const P=N.readUInt16BE(N.length-2);if(!d.some(O=>O===P))throw new ye(P);return N}),this._appAPIlock=null,this.tracer=new z(e??Ct,t)}exchange(t,{abortTimeoutMs:e}={}){throw new Error("exchange not implemented")}exchangeBulk(t,e){let n=!1;const i=()=>{n=!0};return W(this,void 0,void 0,function*(){if(!n)for(const l of t){const u=yield this.exchange(l);if(n)return;const o=u.readUInt16BE(u.length-2);if(o!==Ae.OK)throw new ye(o);e.next(u)}}).then(()=>!n&&e.complete(),l=>!n&&e.error(l)),{unsubscribe:i}}setScrambleKey(t){}close(){return Promise.resolve()}on(t,e){this._events.on(t,e)}off(t,e){this._events.removeListener(t,e)}emit(t,...e){this._events.emit(t,...e)}setDebugMode(){console.warn("setDebugMode is deprecated. use @ledgerhq/logs instead. No logs are emitted in this anymore.")}setExchangeTimeout(t){this.exchangeTimeout=t}setExchangeUnresponsiveTimeout(t){this.unresponsiveTimeout=t}static create(t=3e3,e){return new Promise((n,i)=>{let s=!1;const l=this.listen({next:o=>{s=!0,l&&l.unsubscribe(),u&&clearTimeout(u),this.open(o.descriptor,t).then(n,i)},error:o=>{u&&clearTimeout(u),i(o)},complete:()=>{u&&clearTimeout(u),s||i(new H(this.ErrorMessage_NoDeviceFound,"NoDeviceFound"))}}),u=e?setTimeout(()=>{l.unsubscribe(),i(new H(this.ErrorMessage_ListenTimeout,"ListenTimeout"))},e):null})}exchangeAtomicImpl(t){return W(this,void 0,void 0,function*(){const e=this.tracer.withUpdatedContext({function:"exchangeAtomicImpl",unresponsiveTimeout:this.unresponsiveTimeout});if(this.exchangeBusyPromise)throw e.trace("Atomic exchange is already busy"),new Ot("An action was already pending on the Ledger device. Please deny or reconnect.");let n;const i=new Promise(u=>{n=u});this.exchangeBusyPromise=i;let s=!1;const l=setTimeout(()=>{e.trace('Timeout reached, emitting Transport event "unresponsive"',{unresponsiveTimeout:this.unresponsiveTimeout}),s=!0,this.emit("unresponsive")},this.unresponsiveTimeout);try{const u=yield t();return s&&(e.trace("Device was unresponsive, emitting responsive"),this.emit("responsive")),u}finally{e.trace("Finalize, clearing busy guard"),clearTimeout(l),n&&n(),this.exchangeBusyPromise=null}})}decorateAppAPIMethods(t,e,n){for(const i of e)t[i]=this.decorateAppAPIMethod(i,t[i],t,n)}decorateAppAPIMethod(t,e,n,i){return(...s)=>W(this,void 0,void 0,function*(){const{_appAPIlock:l}=this;if(l)return Promise.reject(new H("Ledger Device is busy (lock "+l+")","TransportLocked"));try{return this._appAPIlock=t,this.setScrambleKey(i),yield e.apply(n,s)}finally{this._appAPIlock=null}})}setTraceContext(t){this.tracer=this.tracer.withContext(t)}updateTraceContext(t){this.tracer.updateContext(t)}getTraceContext(){return this.tracer.getContext()}}Ie.ErrorMessage_ListenTimeout="No Ledger device found (timeout)";Ie.ErrorMessage_NoDeviceFound="No Ledger device found";var at={};const Dt=yt(At);(function(r){r.__esModule=!0;var t=Dt,e=5;function n(l){var u=b.Buffer.alloc(2);return u.writeUInt16BE(l,0),u}var i={data:b.Buffer.alloc(0),dataLength:0,sequence:0},s=function(l,u){return{makeBlocks:function(o){var a=b.Buffer.concat([n(o.length),o]),c=u-5,f=Math.ceil(a.length/c);a=b.Buffer.concat([a,b.Buffer.alloc(f*c-a.length+1).fill(0)]);for(var g=[],d=0;d<f;d++){var p=b.Buffer.alloc(5);p.writeUInt16BE(l,0),p.writeUInt8(e,2),p.writeUInt16BE(d,3);var y=a.slice(d*c,(d+1)*c);g.push(b.Buffer.concat([p,y]))}return g},reduceResponse:function(o,a){var c=o||i,f=c.data,g=c.dataLength,d=c.sequence;if(a.readUInt16BE(0)!==l)throw new t.TransportError("Invalid channel","InvalidChannel");if(a.readUInt8(2)!==e)throw new t.TransportError("Invalid tag","InvalidTag");if(a.readUInt16BE(3)!==d)throw new t.TransportError("Invalid sequence","InvalidSequence");o||(g=a.readUInt16BE(5)),d++;var p=a.slice(o?5:7);return f=b.Buffer.concat([f,p]),f.length>g&&(f=f.slice(0,g)),{data:f,dataLength:g,sequence:d}},getReducedResult:function(o){if(o&&o.dataLength===o.data.length)return o.data}}};r.default=s})(at);const Ut=st(at);var Ee={exports:{}};const Ft="2.0.0",ct=256,jt=Number.MAX_SAFE_INTEGER||9007199254740991,Gt=16,Bt=ct-6,Xt=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var re={MAX_LENGTH:ct,MAX_SAFE_COMPONENT_LENGTH:Gt,MAX_SAFE_BUILD_LENGTH:Bt,MAX_SAFE_INTEGER:jt,RELEASE_TYPES:Xt,SEMVER_SPEC_VERSION:Ft,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},ae={};const kt=typeof process=="object"&&ae&&ae.NODE_DEBUG&&/\bsemver\b/i.test(ae.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};var ne=kt;(function(r,t){const{MAX_SAFE_COMPONENT_LENGTH:e,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:i}=re,s=ne;t=r.exports={};const l=t.re=[],u=t.safeRe=[],o=t.src=[],a=t.t={};let c=0;const f="[a-zA-Z0-9-]",g=[["\\s",1],["\\d",i],[f,n]],d=y=>{for(const[N,P]of g)y=y.split(`${N}*`).join(`${N}{0,${P}}`).split(`${N}+`).join(`${N}{1,${P}}`);return y},p=(y,N,P)=>{const O=d(N),B=c++;s(y,B,N),a[y]=B,o[B]=N,l[B]=new RegExp(N,P?"g":void 0),u[B]=new RegExp(O,P?"g":void 0)};p("NUMERICIDENTIFIER","0|[1-9]\\d*"),p("NUMERICIDENTIFIERLOOSE","\\d+"),p("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${f}*`),p("MAINVERSION",`(${o[a.NUMERICIDENTIFIER]})\\.(${o[a.NUMERICIDENTIFIER]})\\.(${o[a.NUMERICIDENTIFIER]})`),p("MAINVERSIONLOOSE",`(${o[a.NUMERICIDENTIFIERLOOSE]})\\.(${o[a.NUMERICIDENTIFIERLOOSE]})\\.(${o[a.NUMERICIDENTIFIERLOOSE]})`),p("PRERELEASEIDENTIFIER",`(?:${o[a.NUMERICIDENTIFIER]}|${o[a.NONNUMERICIDENTIFIER]})`),p("PRERELEASEIDENTIFIERLOOSE",`(?:${o[a.NUMERICIDENTIFIERLOOSE]}|${o[a.NONNUMERICIDENTIFIER]})`),p("PRERELEASE",`(?:-(${o[a.PRERELEASEIDENTIFIER]}(?:\\.${o[a.PRERELEASEIDENTIFIER]})*))`),p("PRERELEASELOOSE",`(?:-?(${o[a.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${o[a.PRERELEASEIDENTIFIERLOOSE]})*))`),p("BUILDIDENTIFIER",`${f}+`),p("BUILD",`(?:\\+(${o[a.BUILDIDENTIFIER]}(?:\\.${o[a.BUILDIDENTIFIER]})*))`),p("FULLPLAIN",`v?${o[a.MAINVERSION]}${o[a.PRERELEASE]}?${o[a.BUILD]}?`),p("FULL",`^${o[a.FULLPLAIN]}$`),p("LOOSEPLAIN",`[v=\\s]*${o[a.MAINVERSIONLOOSE]}${o[a.PRERELEASELOOSE]}?${o[a.BUILD]}?`),p("LOOSE",`^${o[a.LOOSEPLAIN]}$`),p("GTLT","((?:<|>)?=?)"),p("XRANGEIDENTIFIERLOOSE",`${o[a.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),p("XRANGEIDENTIFIER",`${o[a.NUMERICIDENTIFIER]}|x|X|\\*`),p("XRANGEPLAIN",`[v=\\s]*(${o[a.XRANGEIDENTIFIER]})(?:\\.(${o[a.XRANGEIDENTIFIER]})(?:\\.(${o[a.XRANGEIDENTIFIER]})(?:${o[a.PRERELEASE]})?${o[a.BUILD]}?)?)?`),p("XRANGEPLAINLOOSE",`[v=\\s]*(${o[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[a.XRANGEIDENTIFIERLOOSE]})(?:\\.(${o[a.XRANGEIDENTIFIERLOOSE]})(?:${o[a.PRERELEASELOOSE]})?${o[a.BUILD]}?)?)?`),p("XRANGE",`^${o[a.GTLT]}\\s*${o[a.XRANGEPLAIN]}$`),p("XRANGELOOSE",`^${o[a.GTLT]}\\s*${o[a.XRANGEPLAINLOOSE]}$`),p("COERCEPLAIN",`(^|[^\\d])(\\d{1,${e}})(?:\\.(\\d{1,${e}}))?(?:\\.(\\d{1,${e}}))?`),p("COERCE",`${o[a.COERCEPLAIN]}(?:$|[^\\d])`),p("COERCEFULL",o[a.COERCEPLAIN]+`(?:${o[a.PRERELEASE]})?(?:${o[a.BUILD]})?(?:$|[^\\d])`),p("COERCERTL",o[a.COERCE],!0),p("COERCERTLFULL",o[a.COERCEFULL],!0),p("LONETILDE","(?:~>?)"),p("TILDETRIM",`(\\s*)${o[a.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",p("TILDE",`^${o[a.LONETILDE]}${o[a.XRANGEPLAIN]}$`),p("TILDELOOSE",`^${o[a.LONETILDE]}${o[a.XRANGEPLAINLOOSE]}$`),p("LONECARET","(?:\\^)"),p("CARETTRIM",`(\\s*)${o[a.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",p("CARET",`^${o[a.LONECARET]}${o[a.XRANGEPLAIN]}$`),p("CARETLOOSE",`^${o[a.LONECARET]}${o[a.XRANGEPLAINLOOSE]}$`),p("COMPARATORLOOSE",`^${o[a.GTLT]}\\s*(${o[a.LOOSEPLAIN]})$|^$`),p("COMPARATOR",`^${o[a.GTLT]}\\s*(${o[a.FULLPLAIN]})$|^$`),p("COMPARATORTRIM",`(\\s*)${o[a.GTLT]}\\s*(${o[a.LOOSEPLAIN]}|${o[a.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",p("HYPHENRANGE",`^\\s*(${o[a.XRANGEPLAIN]})\\s+-\\s+(${o[a.XRANGEPLAIN]})\\s*$`),p("HYPHENRANGELOOSE",`^\\s*(${o[a.XRANGEPLAINLOOSE]})\\s+-\\s+(${o[a.XRANGEPLAINLOOSE]})\\s*$`),p("STAR","(<|>)?=?\\s*\\*"),p("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),p("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(Ee,Ee.exports);var Y=Ee.exports;const Vt=Object.freeze({loose:!0}),Mt=Object.freeze({}),qt=r=>r?typeof r!="object"?Vt:r:Mt;var ge=qt;const xe=/^[0-9]+$/,lt=(r,t)=>{const e=xe.test(r),n=xe.test(t);return e&&n&&(r=+r,t=+t),r===t?0:e&&!n?-1:n&&!e?1:r<t?-1:1},Ht=(r,t)=>lt(t,r);var ut={compareIdentifiers:lt,rcompareIdentifiers:Ht};const K=ne,{MAX_LENGTH:be,MAX_SAFE_INTEGER:Z}=re,{safeRe:Ce,t:De}=Y,zt=ge,{compareIdentifiers:k}=ut;let Yt=class U{constructor(t,e){if(e=zt(e),t instanceof U){if(t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof t}".`);if(t.length>be)throw new TypeError(`version is longer than ${be} characters`);K("SemVer",t,e),this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease;const n=t.trim().match(e.loose?Ce[De.LOOSE]:Ce[De.FULL]);if(!n)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Z||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Z||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Z||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){const s=+i;if(s>=0&&s<Z)return s}return i}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(K("SemVer.compare",this.version,this.options,t),!(t instanceof U)){if(typeof t=="string"&&t===this.version)return 0;t=new U(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof U||(t=new U(t,this.options)),k(this.major,t.major)||k(this.minor,t.minor)||k(this.patch,t.patch)}comparePre(t){if(t instanceof U||(t=new U(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let e=0;do{const n=this.prerelease[e],i=t.prerelease[e];if(K("prerelease compare",e,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return k(n,i)}while(++e)}compareBuild(t){t instanceof U||(t=new U(t,this.options));let e=0;do{const n=this.build[e],i=t.build[e];if(K("build compare",e,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return k(n,i)}while(++e)}inc(t,e,n){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e,n),this.inc("pre",e,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",e,n),this.inc("pre",e,n);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const i=Number(n)?1:0;if(!e&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[i];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(e===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(e){let s=[e,i];n===!1&&(s=[e]),k(this.prerelease[0],e)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${t}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var _=Yt;const Ue=_,Wt=(r,t,e=!1)=>{if(r instanceof Ue)return r;try{return new Ue(r,t)}catch(n){if(!e)return null;throw n}};var V=Wt;const Kt=V,Zt=(r,t)=>{const e=Kt(r,t);return e?e.version:null};var Jt=Zt;const Qt=V,er=(r,t)=>{const e=Qt(r.trim().replace(/^[=v]+/,""),t);return e?e.version:null};var tr=er;const Fe=_,rr=(r,t,e,n,i)=>{typeof e=="string"&&(i=n,n=e,e=void 0);try{return new Fe(r instanceof Fe?r.version:r,e).inc(t,n,i).version}catch{return null}};var nr=rr;const je=V,sr=(r,t)=>{const e=je(r,null,!0),n=je(t,null,!0),i=e.compare(n);if(i===0)return null;const s=i>0,l=s?e:n,u=s?n:e,o=!!l.prerelease.length;if(!!u.prerelease.length&&!o)return!u.patch&&!u.minor?"major":l.patch?"patch":l.minor?"minor":"major";const c=o?"pre":"";return e.major!==n.major?c+"major":e.minor!==n.minor?c+"minor":e.patch!==n.patch?c+"patch":"prerelease"};var ir=sr;const or=_,ar=(r,t)=>new or(r,t).major;var cr=ar;const lr=_,ur=(r,t)=>new lr(r,t).minor;var fr=ur;const hr=_,dr=(r,t)=>new hr(r,t).patch;var pr=dr;const Er=V,mr=(r,t)=>{const e=Er(r,t);return e&&e.prerelease.length?e.prerelease:null};var $r=mr;const Ge=_,vr=(r,t,e)=>new Ge(r,e).compare(new Ge(t,e));var C=vr;const Ir=C,gr=(r,t,e)=>Ir(t,r,e);var Rr=gr;const wr=C,Lr=(r,t)=>wr(r,t,!0);var Sr=Lr;const Be=_,Tr=(r,t,e)=>{const n=new Be(r,e),i=new Be(t,e);return n.compare(i)||n.compareBuild(i)};var Re=Tr;const Nr=Re,Or=(r,t)=>r.sort((e,n)=>Nr(e,n,t));var yr=Or;const Ar=Re,Pr=(r,t)=>r.sort((e,n)=>Ar(n,e,t));var _r=Pr;const xr=C,br=(r,t,e)=>xr(r,t,e)>0;var se=br;const Cr=C,Dr=(r,t,e)=>Cr(r,t,e)<0;var we=Dr;const Ur=C,Fr=(r,t,e)=>Ur(r,t,e)===0;var ft=Fr;const jr=C,Gr=(r,t,e)=>jr(r,t,e)!==0;var ht=Gr;const Br=C,Xr=(r,t,e)=>Br(r,t,e)>=0;var Le=Xr;const kr=C,Vr=(r,t,e)=>kr(r,t,e)<=0;var Se=Vr;const Mr=ft,qr=ht,Hr=se,zr=Le,Yr=we,Wr=Se,Kr=(r,t,e,n)=>{switch(t){case"===":return typeof r=="object"&&(r=r.version),typeof e=="object"&&(e=e.version),r===e;case"!==":return typeof r=="object"&&(r=r.version),typeof e=="object"&&(e=e.version),r!==e;case"":case"=":case"==":return Mr(r,e,n);case"!=":return qr(r,e,n);case">":return Hr(r,e,n);case">=":return zr(r,e,n);case"<":return Yr(r,e,n);case"<=":return Wr(r,e,n);default:throw new TypeError(`Invalid operator: ${t}`)}};var dt=Kr;const Zr=_,Jr=V,{safeRe:J,t:Q}=Y,Qr=(r,t)=>{if(r instanceof Zr)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;t=t||{};let e=null;if(!t.rtl)e=r.match(t.includePrerelease?J[Q.COERCEFULL]:J[Q.COERCE]);else{const o=t.includePrerelease?J[Q.COERCERTLFULL]:J[Q.COERCERTL];let a;for(;(a=o.exec(r))&&(!e||e.index+e[0].length!==r.length);)(!e||a.index+a[0].length!==e.index+e[0].length)&&(e=a),o.lastIndex=a.index+a[1].length+a[2].length;o.lastIndex=-1}if(e===null)return null;const n=e[2],i=e[3]||"0",s=e[4]||"0",l=t.includePrerelease&&e[5]?`-${e[5]}`:"",u=t.includePrerelease&&e[6]?`+${e[6]}`:"";return Jr(`${n}.${i}.${s}${l}${u}`,t)};var en=Qr;class tn{constructor(){this.max=1e3,this.map=new Map}get(t){const e=this.map.get(t);if(e!==void 0)return this.map.delete(t),this.map.set(t,e),e}delete(t){return this.map.delete(t)}set(t,e){if(!this.delete(t)&&e!==void 0){if(this.map.size>=this.max){const i=this.map.keys().next().value;this.delete(i)}this.map.set(t,e)}return this}}var rn=tn,ce,Xe;function D(){if(Xe)return ce;Xe=1;class r{constructor(h,I){if(I=n(I),h instanceof r)return h.loose===!!I.loose&&h.includePrerelease===!!I.includePrerelease?h:new r(h.raw,I);if(h instanceof i)return this.raw=h.value,this.set=[[h]],this.format(),this;if(this.options=I,this.loose=!!I.loose,this.includePrerelease=!!I.includePrerelease,this.raw=h.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map($=>this.parseRange($.trim())).filter($=>$.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const $=this.set[0];if(this.set=this.set.filter(v=>!p(v[0])),this.set.length===0)this.set=[$];else if(this.set.length>1){for(const v of this.set)if(v.length===1&&y(v[0])){this.set=[v];break}}}this.format()}format(){return this.range=this.set.map(h=>h.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(h){const $=((this.options.includePrerelease&&g)|(this.options.loose&&d))+":"+h,v=e.get($);if(v)return v;const m=this.options.loose,R=m?u[o.HYPHENRANGELOOSE]:u[o.HYPHENRANGE];h=h.replace(R,St(this.options.includePrerelease)),s("hyphen replace",h),h=h.replace(u[o.COMPARATORTRIM],a),s("comparator trim",h),h=h.replace(u[o.TILDETRIM],c),s("tilde trim",h),h=h.replace(u[o.CARETTRIM],f),s("caret trim",h);let L=h.split(" ").map(T=>P(T,this.options)).join(" ").split(/\s+/).map(T=>Lt(T,this.options));m&&(L=L.filter(T=>(s("loose invalid filter",T,this.options),!!T.match(u[o.COMPARATORLOOSE])))),s("range list",L);const w=new Map,S=L.map(T=>new i(T,this.options));for(const T of S){if(p(T))return[T];w.set(T.value,T)}w.size>1&&w.has("")&&w.delete("");const x=[...w.values()];return e.set($,x),x}intersects(h,I){if(!(h instanceof r))throw new TypeError("a Range is required");return this.set.some($=>N($,I)&&h.set.some(v=>N(v,I)&&$.every(m=>v.every(R=>m.intersects(R,I)))))}test(h){if(!h)return!1;if(typeof h=="string")try{h=new l(h,this.options)}catch{return!1}for(let I=0;I<this.set.length;I++)if(Tt(this.set[I],h,this.options))return!0;return!1}}ce=r;const t=rn,e=new t,n=ge,i=ie(),s=ne,l=_,{safeRe:u,t:o,comparatorTrimReplace:a,tildeTrimReplace:c,caretTrimReplace:f}=Y,{FLAG_INCLUDE_PRERELEASE:g,FLAG_LOOSE:d}=re,p=E=>E.value==="<0.0.0-0",y=E=>E.value==="",N=(E,h)=>{let I=!0;const $=E.slice();let v=$.pop();for(;I&&$.length;)I=$.every(m=>v.intersects(m,h)),v=$.pop();return I},P=(E,h)=>(s("comp",E,h),E=vt(E,h),s("caret",E),E=B(E,h),s("tildes",E),E=gt(E,h),s("xrange",E),E=wt(E,h),s("stars",E),E),O=E=>!E||E.toLowerCase()==="x"||E==="*",B=(E,h)=>E.trim().split(/\s+/).map(I=>$t(I,h)).join(" "),$t=(E,h)=>{const I=h.loose?u[o.TILDELOOSE]:u[o.TILDE];return E.replace(I,($,v,m,R,L)=>{s("tilde",E,$,v,m,R,L);let w;return O(v)?w="":O(m)?w=`>=${v}.0.0 <${+v+1}.0.0-0`:O(R)?w=`>=${v}.${m}.0 <${v}.${+m+1}.0-0`:L?(s("replaceTilde pr",L),w=`>=${v}.${m}.${R}-${L} <${v}.${+m+1}.0-0`):w=`>=${v}.${m}.${R} <${v}.${+m+1}.0-0`,s("tilde return",w),w})},vt=(E,h)=>E.trim().split(/\s+/).map(I=>It(I,h)).join(" "),It=(E,h)=>{s("caret",E,h);const I=h.loose?u[o.CARETLOOSE]:u[o.CARET],$=h.includePrerelease?"-0":"";return E.replace(I,(v,m,R,L,w)=>{s("caret",E,v,m,R,L,w);let S;return O(m)?S="":O(R)?S=`>=${m}.0.0${$} <${+m+1}.0.0-0`:O(L)?m==="0"?S=`>=${m}.${R}.0${$} <${m}.${+R+1}.0-0`:S=`>=${m}.${R}.0${$} <${+m+1}.0.0-0`:w?(s("replaceCaret pr",w),m==="0"?R==="0"?S=`>=${m}.${R}.${L}-${w} <${m}.${R}.${+L+1}-0`:S=`>=${m}.${R}.${L}-${w} <${m}.${+R+1}.0-0`:S=`>=${m}.${R}.${L}-${w} <${+m+1}.0.0-0`):(s("no pr"),m==="0"?R==="0"?S=`>=${m}.${R}.${L}${$} <${m}.${R}.${+L+1}-0`:S=`>=${m}.${R}.${L}${$} <${m}.${+R+1}.0-0`:S=`>=${m}.${R}.${L} <${+m+1}.0.0-0`),s("caret return",S),S})},gt=(E,h)=>(s("replaceXRanges",E,h),E.split(/\s+/).map(I=>Rt(I,h)).join(" ")),Rt=(E,h)=>{E=E.trim();const I=h.loose?u[o.XRANGELOOSE]:u[o.XRANGE];return E.replace(I,($,v,m,R,L,w)=>{s("xRange",E,$,v,m,R,L,w);const S=O(m),x=S||O(R),T=x||O(L),M=T;return v==="="&&M&&(v=""),w=h.includePrerelease?"-0":"",S?v===">"||v==="<"?$="<0.0.0-0":$="*":v&&M?(x&&(R=0),L=0,v===">"?(v=">=",x?(m=+m+1,R=0,L=0):(R=+R+1,L=0)):v==="<="&&(v="<",x?m=+m+1:R=+R+1),v==="<"&&(w="-0"),$=`${v+m}.${R}.${L}${w}`):x?$=`>=${m}.0.0${w} <${+m+1}.0.0-0`:T&&($=`>=${m}.${R}.0${w} <${m}.${+R+1}.0-0`),s("xRange return",$),$})},wt=(E,h)=>(s("replaceStars",E,h),E.trim().replace(u[o.STAR],"")),Lt=(E,h)=>(s("replaceGTE0",E,h),E.trim().replace(u[h.includePrerelease?o.GTE0PRE:o.GTE0],"")),St=E=>(h,I,$,v,m,R,L,w,S,x,T,M)=>(O($)?I="":O(v)?I=`>=${$}.0.0${E?"-0":""}`:O(m)?I=`>=${$}.${v}.0${E?"-0":""}`:R?I=`>=${I}`:I=`>=${I}${E?"-0":""}`,O(S)?w="":O(x)?w=`<${+S+1}.0.0-0`:O(T)?w=`<${S}.${+x+1}.0-0`:M?w=`<=${S}.${x}.${T}-${M}`:E?w=`<${S}.${x}.${+T+1}-0`:w=`<=${w}`,`${I} ${w}`.trim()),Tt=(E,h,I)=>{for(let $=0;$<E.length;$++)if(!E[$].test(h))return!1;if(h.prerelease.length&&!I.includePrerelease){for(let $=0;$<E.length;$++)if(s(E[$].semver),E[$].semver!==i.ANY&&E[$].semver.prerelease.length>0){const v=E[$].semver;if(v.major===h.major&&v.minor===h.minor&&v.patch===h.patch)return!0}return!1}return!0};return ce}var le,ke;function ie(){if(ke)return le;ke=1;const r=Symbol("SemVer ANY");class t{static get ANY(){return r}constructor(c,f){if(f=e(f),c instanceof t){if(c.loose===!!f.loose)return c;c=c.value}c=c.trim().split(/\s+/).join(" "),l("comparator",c,f),this.options=f,this.loose=!!f.loose,this.parse(c),this.semver===r?this.value="":this.value=this.operator+this.semver.version,l("comp",this)}parse(c){const f=this.options.loose?n[i.COMPARATORLOOSE]:n[i.COMPARATOR],g=c.match(f);if(!g)throw new TypeError(`Invalid comparator: ${c}`);this.operator=g[1]!==void 0?g[1]:"",this.operator==="="&&(this.operator=""),g[2]?this.semver=new u(g[2],this.options.loose):this.semver=r}toString(){return this.value}test(c){if(l("Comparator.test",c,this.options.loose),this.semver===r||c===r)return!0;if(typeof c=="string")try{c=new u(c,this.options)}catch{return!1}return s(c,this.operator,this.semver,this.options)}intersects(c,f){if(!(c instanceof t))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new o(c.value,f).test(this.value):c.operator===""?c.value===""?!0:new o(this.value,f).test(c.semver):(f=e(f),f.includePrerelease&&(this.value==="<0.0.0-0"||c.value==="<0.0.0-0")||!f.includePrerelease&&(this.value.startsWith("<0.0.0")||c.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&c.operator.startsWith(">")||this.operator.startsWith("<")&&c.operator.startsWith("<")||this.semver.version===c.semver.version&&this.operator.includes("=")&&c.operator.includes("=")||s(this.semver,"<",c.semver,f)&&this.operator.startsWith(">")&&c.operator.startsWith("<")||s(this.semver,">",c.semver,f)&&this.operator.startsWith("<")&&c.operator.startsWith(">")))}}le=t;const e=ge,{safeRe:n,t:i}=Y,s=dt,l=ne,u=_,o=D();return le}const nn=D(),sn=(r,t,e)=>{try{t=new nn(t,e)}catch{return!1}return t.test(r)};var oe=sn;const on=D(),an=(r,t)=>new on(r,t).set.map(e=>e.map(n=>n.value).join(" ").trim().split(" "));var cn=an;const ln=_,un=D(),fn=(r,t,e)=>{let n=null,i=null,s=null;try{s=new un(t,e)}catch{return null}return r.forEach(l=>{s.test(l)&&(!n||i.compare(l)===-1)&&(n=l,i=new ln(n,e))}),n};var hn=fn;const dn=_,pn=D(),En=(r,t,e)=>{let n=null,i=null,s=null;try{s=new pn(t,e)}catch{return null}return r.forEach(l=>{s.test(l)&&(!n||i.compare(l)===1)&&(n=l,i=new dn(n,e))}),n};var mn=En;const ue=_,$n=D(),Ve=se,vn=(r,t)=>{r=new $n(r,t);let e=new ue("0.0.0");if(r.test(e)||(e=new ue("0.0.0-0"),r.test(e)))return e;e=null;for(let n=0;n<r.set.length;++n){const i=r.set[n];let s=null;i.forEach(l=>{const u=new ue(l.semver.version);switch(l.operator){case">":u.prerelease.length===0?u.patch++:u.prerelease.push(0),u.raw=u.format();case"":case">=":(!s||Ve(u,s))&&(s=u);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${l.operator}`)}}),s&&(!e||Ve(e,s))&&(e=s)}return e&&r.test(e)?e:null};var In=vn;const gn=D(),Rn=(r,t)=>{try{return new gn(r,t).range||"*"}catch{return null}};var wn=Rn;const Ln=_,pt=ie(),{ANY:Sn}=pt,Tn=D(),Nn=oe,Me=se,qe=we,On=Se,yn=Le,An=(r,t,e,n)=>{r=new Ln(r,n),t=new Tn(t,n);let i,s,l,u,o;switch(e){case">":i=Me,s=On,l=qe,u=">",o=">=";break;case"<":i=qe,s=yn,l=Me,u="<",o="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Nn(r,t,n))return!1;for(let a=0;a<t.set.length;++a){const c=t.set[a];let f=null,g=null;if(c.forEach(d=>{d.semver===Sn&&(d=new pt(">=0.0.0")),f=f||d,g=g||d,i(d.semver,f.semver,n)?f=d:l(d.semver,g.semver,n)&&(g=d)}),f.operator===u||f.operator===o||(!g.operator||g.operator===u)&&s(r,g.semver))return!1;if(g.operator===o&&l(r,g.semver))return!1}return!0};var Te=An;const Pn=Te,_n=(r,t,e)=>Pn(r,t,">",e);var xn=_n;const bn=Te,Cn=(r,t,e)=>bn(r,t,"<",e);var Dn=Cn;const He=D(),Un=(r,t,e)=>(r=new He(r,e),t=new He(t,e),r.intersects(t,e));var Fn=Un;const jn=oe,Gn=C;var Bn=(r,t,e)=>{const n=[];let i=null,s=null;const l=r.sort((c,f)=>Gn(c,f,e));for(const c of l)jn(c,t,e)?(s=c,i||(i=c)):(s&&n.push([i,s]),s=null,i=null);i&&n.push([i,null]);const u=[];for(const[c,f]of n)c===f?u.push(c):!f&&c===l[0]?u.push("*"):f?c===l[0]?u.push(`<=${f}`):u.push(`${c} - ${f}`):u.push(`>=${c}`);const o=u.join(" || "),a=typeof t.raw=="string"?t.raw:String(t);return o.length<a.length?o:t};const ze=D(),Ne=ie(),{ANY:fe}=Ne,q=oe,Oe=C,Xn=(r,t,e={})=>{if(r===t)return!0;r=new ze(r,e),t=new ze(t,e);let n=!1;e:for(const i of r.set){for(const s of t.set){const l=Vn(i,s,e);if(n=n||l!==null,l)continue e}if(n)return!1}return!0},kn=[new Ne(">=0.0.0-0")],Ye=[new Ne(">=0.0.0")],Vn=(r,t,e)=>{if(r===t)return!0;if(r.length===1&&r[0].semver===fe){if(t.length===1&&t[0].semver===fe)return!0;e.includePrerelease?r=kn:r=Ye}if(t.length===1&&t[0].semver===fe){if(e.includePrerelease)return!0;t=Ye}const n=new Set;let i,s;for(const d of r)d.operator===">"||d.operator===">="?i=We(i,d,e):d.operator==="<"||d.operator==="<="?s=Ke(s,d,e):n.add(d.semver);if(n.size>1)return null;let l;if(i&&s){if(l=Oe(i.semver,s.semver,e),l>0)return null;if(l===0&&(i.operator!==">="||s.operator!=="<="))return null}for(const d of n){if(i&&!q(d,String(i),e)||s&&!q(d,String(s),e))return null;for(const p of t)if(!q(d,String(p),e))return!1;return!0}let u,o,a,c,f=s&&!e.includePrerelease&&s.semver.prerelease.length?s.semver:!1,g=i&&!e.includePrerelease&&i.semver.prerelease.length?i.semver:!1;f&&f.prerelease.length===1&&s.operator==="<"&&f.prerelease[0]===0&&(f=!1);for(const d of t){if(c=c||d.operator===">"||d.operator===">=",a=a||d.operator==="<"||d.operator==="<=",i){if(g&&d.semver.prerelease&&d.semver.prerelease.length&&d.semver.major===g.major&&d.semver.minor===g.minor&&d.semver.patch===g.patch&&(g=!1),d.operator===">"||d.operator===">="){if(u=We(i,d,e),u===d&&u!==i)return!1}else if(i.operator===">="&&!q(i.semver,String(d),e))return!1}if(s){if(f&&d.semver.prerelease&&d.semver.prerelease.length&&d.semver.major===f.major&&d.semver.minor===f.minor&&d.semver.patch===f.patch&&(f=!1),d.operator==="<"||d.operator==="<="){if(o=Ke(s,d,e),o===d&&o!==s)return!1}else if(s.operator==="<="&&!q(s.semver,String(d),e))return!1}if(!d.operator&&(s||i)&&l!==0)return!1}return!(i&&a&&!s&&l!==0||s&&c&&!i&&l!==0||g||f)},We=(r,t,e)=>{if(!r)return t;const n=Oe(r.semver,t.semver,e);return n>0?r:n<0||t.operator===">"&&r.operator===">="?t:r},Ke=(r,t,e)=>{if(!r)return t;const n=Oe(r.semver,t.semver,e);return n<0?r:n>0||t.operator==="<"&&r.operator==="<="?t:r};var Mn=Xn;const he=Y,Ze=re,qn=_,Je=ut,Hn=V,zn=Jt,Yn=tr,Wn=nr,Kn=ir,Zn=cr,Jn=fr,Qn=pr,es=$r,ts=C,rs=Rr,ns=Sr,ss=Re,is=yr,os=_r,as=se,cs=we,ls=ft,us=ht,fs=Le,hs=Se,ds=dt,ps=en,Es=ie(),ms=D(),$s=oe,vs=cn,Is=hn,gs=mn,Rs=In,ws=wn,Ls=Te,Ss=xn,Ts=Dn,Ns=Fn,Os=Bn,ys=Mn;var As={parse:Hn,valid:zn,clean:Yn,inc:Wn,diff:Kn,major:Zn,minor:Jn,patch:Qn,prerelease:es,compare:ts,rcompare:rs,compareLoose:ns,compareBuild:ss,sort:is,rsort:os,gt:as,lt:cs,eq:ls,neq:us,gte:fs,lte:hs,cmp:ds,coerce:ps,Comparator:Es,Range:ms,satisfies:$s,toComparators:vs,maxSatisfying:Is,minSatisfying:gs,minVersion:Rs,validRange:ws,outside:Ls,gtr:Ss,ltr:Ts,intersects:Ns,simplifyRange:Os,subset:ys,SemVer:qn,re:he.re,src:he.src,tokens:he.t,SEMVER_SPEC_VERSION:Ze.SEMVER_SPEC_VERSION,RELEASE_TYPES:Ze.RELEASE_TYPES,compareIdentifiers:Je.compareIdentifiers,rcompareIdentifiers:Je.rcompareIdentifiers};const Qe=st(As);var me=function(){return me=Object.assign||function(r){for(var t,e=1,n=arguments.length;e<n;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},me.apply(this,arguments)},X,A;(function(r){r.blue="blue",r.nanoS="nanoS",r.nanoSP="nanoSP",r.nanoX="nanoX",r.nanoFTS="nanoFTS"})(A||(A={}));var $e=(X={},X[A.blue]={id:A.blue,productName:"Ledger Blue",productIdMM:0,legacyUsbProductId:0,usbOnly:!0,memorySize:480*1024,masks:[822083584,822149120],getBlockSize:function(r){return 4*1024}},X[A.nanoS]={id:A.nanoS,productName:"Ledger Nano S",productIdMM:16,legacyUsbProductId:1,usbOnly:!0,memorySize:320*1024,masks:[823132160],getBlockSize:function(r){var t;return Qe.lt((t=Qe.coerce(r))!==null&&t!==void 0?t:"","2.0.0")?4*1024:2*1024}},X[A.nanoSP]={id:A.nanoSP,productName:"Ledger Nano S Plus",productIdMM:80,legacyUsbProductId:5,usbOnly:!0,memorySize:1536*1024,masks:[856686592],getBlockSize:function(r){return 32}},X[A.nanoX]={id:A.nanoX,productName:"Ledger Nano X",productIdMM:64,legacyUsbProductId:4,usbOnly:!1,memorySize:2*1024*1024,masks:[855638016],getBlockSize:function(r){return 4*1024},bluetoothSpec:[{serviceUuid:"13d63400-2c97-0004-0000-4c6564676572",notifyUuid:"13d63400-2c97-0004-0001-4c6564676572",writeUuid:"13d63400-2c97-0004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-0004-0003-4c6564676572"}]},X[A.nanoFTS]={id:A.nanoFTS,productName:"Ledger Nano FTS",productIdMM:96,legacyUsbProductId:6,usbOnly:!1,memorySize:2*1024*1024,masks:[857735168],getBlockSize:function(r){return 4*1024},bluetoothSpec:[{serviceUuid:"13d63400-2c97-6004-0000-4c6564676572",notifyUuid:"13d63400-2c97-6004-0001-4c6564676572",writeUuid:"13d63400-2c97-6004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-6004-0003-4c6564676572"}]},X);A.blue,A.nanoS,A.nanoSP,A.nanoX,A.nanoFTS;var et=Object.values($e),Et=11415,tt=function(r){var t=et.find(function(i){return i.legacyUsbProductId===r});if(t)return t;var e=r>>8,n=et.find(function(i){return i.productIdMM===e});return n},Ps=[],rt={};for(var _s in $e){var nt=$e[_s],de=nt.bluetoothSpec;if(de)for(var pe=0;pe<de.length;pe++){var ee=de[pe];Ps.push(ee.serviceUuid),rt[ee.serviceUuid]=rt[ee.serviceUuid.replace(/-/g,"")]=me({deviceModel:nt},ee)}}var xs=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),F=function(r,t,e,n){function i(s){return s instanceof e?s:new e(function(l){l(s)})}return new(e||(e=Promise))(function(s,l){function u(c){try{a(n.next(c))}catch(f){l(f)}}function o(c){try{a(n.throw(c))}catch(f){l(f)}}function a(c){c.done?s(c.value):i(c.value).then(u,o)}a((n=n.apply(r,t||[])).next())})},j=function(r,t){var e={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,l;return l={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function u(a){return function(c){return o([a,c])}}function o(a){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,i&&(s=a[0]&2?i.return:a[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,a[1])).done)return s;switch(i=0,s&&(a=[a[0]&2,s.value]),a[0]){case 0:case 1:s=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,i=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(s=e.trys,!(s=s.length>0&&s[s.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!s||a[1]>s[0]&&a[1]<s[3])){e.label=a[1];break}if(a[0]===6&&e.label<s[1]){e.label=s[1],s=a;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(a);break}s[2]&&e.ops.pop(),e.trys.pop();continue}a=t.call(r,e)}catch(c){a=[6,c],i=0}finally{n=s=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},bs=function(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var n=e.call(r),i,s=[],l;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(u){l={error:u}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(l)throw l.error}}return s},Cs=[{vendorId:Et}],Ds=function(){return Promise.resolve(!!(window.navigator&&window.navigator.hid))},te=function(){var r=navigator.hid;if(!r)throw new H("navigator.hid is not supported","HIDNotSupported");return r};function mt(){return F(this,void 0,void 0,function(){var r;return j(this,function(t){switch(t.label){case 0:return[4,te().requestDevice({filters:Cs})];case 1:return r=t.sent(),Array.isArray(r)?[2,r]:[2,[r]]}})})}function ve(){return F(this,void 0,void 0,function(){var r;return j(this,function(t){switch(t.label){case 0:return[4,te().getDevices()];case 1:return r=t.sent(),[2,r.filter(function(e){return e.vendorId===Et})]}})})}function Us(){return F(this,void 0,void 0,function(){var r,t;return j(this,function(e){switch(e.label){case 0:return[4,ve()];case 1:return r=e.sent(),r.length>0?[2,r[0]]:[4,mt()];case 2:return t=e.sent(),[2,t[0]]}})})}var js=function(r){xs(t,r);function t(e){var n=r.call(this)||this;return n.channel=Math.floor(Math.random()*65535),n.packetSize=64,n.inputs=[],n.read=function(){return n.inputs.length?Promise.resolve(n.inputs.shift()):new Promise(function(i){n.inputCallback=i})},n.onInputReport=function(i){var s=b.Buffer.from(i.data.buffer);n.inputCallback?(n.inputCallback(s),n.inputCallback=null):n.inputs.push(s)},n._disconnectEmitted=!1,n._emitDisconnect=function(i){n._disconnectEmitted||(n._disconnectEmitted=!0,n.emit("disconnect",i))},n.exchange=function(i){return F(n,void 0,void 0,function(){var s,l=this;return j(this,function(u){switch(u.label){case 0:return[4,this.exchangeAtomicImpl(function(){return F(l,void 0,void 0,function(){var o,a,c,f,g,d,p,y,N;return j(this,function(P){switch(P.label){case 0:o=this,a=o.channel,c=o.packetSize,_e("apdu","=> "+i.toString("hex")),f=Ut(a,c),g=f.makeBlocks(i),d=0,P.label=1;case 1:return d<g.length?[4,this.device.sendReport(0,g[d])]:[3,4];case 2:P.sent(),P.label=3;case 3:return d++,[3,1];case 4:return(p=f.getReducedResult(y))?[3,6]:[4,this.read()];case 5:return N=P.sent(),y=f.reduceResponse(y,N),[3,4];case 6:return _e("apdu","<= "+p.toString("hex")),[2,p]}})})}).catch(function(o){throw o&&o.message&&o.message.includes("write")?(l._emitDisconnect(o),new Pt(o.message)):o})];case 1:return s=u.sent(),[2,s]}})})},n.device=e,n.deviceModel=typeof e.productId=="number"?tt(e.productId):void 0,e.addEventListener("inputreport",n.onInputReport),n}return t.request=function(){return F(this,void 0,void 0,function(){var e,n;return j(this,function(i){switch(i.label){case 0:return[4,mt()];case 1:return e=bs.apply(void 0,[i.sent(),1]),n=e[0],[2,t.open(n)]}})})},t.openConnected=function(){return F(this,void 0,void 0,function(){var e;return j(this,function(n){switch(n.label){case 0:return[4,ve()];case 1:return e=n.sent(),e.length===0?[2,null]:[2,t.open(e[0])]}})})},t.open=function(e){return F(this,void 0,void 0,function(){var n,i;return j(this,function(s){switch(s.label){case 0:return[4,e.open()];case 1:return s.sent(),n=new t(e),i=function(l){e===l.device&&(te().removeEventListener("disconnect",i),n._emitDisconnect(new _t))},te().addEventListener("disconnect",i),[2,n]}})})},t.prototype.close=function(){return F(this,void 0,void 0,function(){return j(this,function(e){switch(e.label){case 0:return[4,this.exchangeBusyPromise];case 1:return e.sent(),this.device.removeEventListener("inputreport",this.onInputReport),[4,this.device.close()];case 2:return e.sent(),[2]}})})},t.prototype.setScrambleKey=function(){},t.isSupported=Ds,t.list=ve,t.listen=function(e){var n=!1;Us().then(function(s){if(!s)e.error(new Pe("Access denied to use Ledger device"));else if(!n){var l=typeof s.productId=="number"?tt(s.productId):void 0;e.next({type:"add",descriptor:s,deviceModel:l}),e.complete()}},function(s){e.error(new Pe(s.message))});function i(){n=!0}return{unsubscribe:i}},t}(Ie);export{js as default};
